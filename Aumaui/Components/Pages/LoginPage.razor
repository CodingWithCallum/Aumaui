@page "/login"
@page "/"
@using AumauiCL.ViewModels
@using Microsoft.FluentUI.AspNetCore.Components
@using Aumaui.Components.Layout
@layout LoginLayout
@inject LoginViewModel ViewModel
@inject NavigationManager Navigation

<PageTitle>Login</PageTitle>

@* Removed inline flex style since layout handles it *@
<FluentCard Style="width: 100%; padding: 24px;">
    <h2 style="text-align: center; margin-bottom: 24px;">Aumaui Login</h2>

    <FluentLabel Typo="Typography.Body" Color="Color.Info" Style="margin-bottom: 16px; display: block; text-align: center;">
        Demo: Use any code/email and password "password"
    </FluentLabel>

    <FluentTextField @bind-Value="ViewModel.CompanyCode"
                     Label="Company Code"
                     Placeholder="Enter Company Code"
                     Required="true"
                     Style="width: 100%; margin-bottom: 16px;" />

    <FluentButton Appearance="Appearance.Accent"
                  OnClick="@OnMicrosoftLogin"
                  Disabled="@(!ViewModel.CanLogin || ViewModel.IsBusy)"
                  Style="width: 100%; margin-bottom: 24px;">
        @if (ViewModel.IsBusy)
        {
            <FluentProgressRing Style="width: 20px; height: 20px;" />
        }
        else
        {
            <span>Login with Microsoft</span>
        }
    </FluentButton>

    <FluentDivider Style="margin-bottom: 24px;">OR</FluentDivider>

    <FluentTextField @bind-Value="ViewModel.Email"
                     Label="Email"
                     TextFieldType="TextFieldType.Email"
                     Required="true"
                     Style="width: 100%; margin-bottom: 16px;" />

    <FluentTextField @bind-Value="ViewModel.Password"
                     Label="Password"
                     TextFieldType="TextFieldType.Password"
                     Required="true"
                     Style="width: 100%; margin-bottom: 24px;" />

    <FluentButton Appearance="Appearance.Neutral"
                  OnClick="@OnStandardLogin"
                  Disabled="@(!ViewModel.CanLogin || ViewModel.IsBusy)"
                  Style="width: 100%;">
        Standard Login
    </FluentButton>

    @if (!string.IsNullOrWhiteSpace(ViewModel.ErrorMessage))
    {
        <FluentMessageBar Intent="MessageIntent.Error"
                          AllowDismiss="true"
                          OnDismiss="@(() => ViewModel.ErrorMessage = string.Empty)"
                          Style="margin-top: 16px;">
            @ViewModel.ErrorMessage
        </FluentMessageBar>
    }
</FluentCard>

@code {
    private async Task OnMicrosoftLogin()
    {
        await ViewModel.LoginWithMicrosoftCommand.ExecuteAsync(null);

        if (string.IsNullOrEmpty(ViewModel.ErrorMessage))
        {
            Navigation.NavigateTo("/sync");
        }
    }

    private async Task OnStandardLogin()
    {
        await ViewModel.LoginWithStandardCommand.ExecuteAsync(null);
        
        if (string.IsNullOrEmpty(ViewModel.ErrorMessage))
        {
            Navigation.NavigateTo("/sync");
        }
    }
}
